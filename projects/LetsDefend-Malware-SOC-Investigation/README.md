# LetsDefend Malware SOC Investigation (SOC205 – Malicious Macro Executed)

## Overview
In this project, I investigated a LetsDefend malware alert where a **malicious macro** was executed from a Word document.  
I followed a basic SOC-style workflow: **claim the alert → create a case → review logs/email → verify the file in 3rd-party tools → check C2 → contain the host → document and close**.

---

## What was flagged
- **Alert:** SOC205 – Malicious Macro has been executed  
- **Event ID:** 231  
- **Host:** Jayne  
- **IP Address:** 172.16.17.198  
- **Suspicious file:** `edit1-invoice.docm` (Downloads folder)
- **Goal:** Confirm if it’s truly malicious, identify how it arrived, and contain the host to prevent more damage.

---

## Investigation Steps (with screenshots)

### Step 1 — Check the alert ticket
**What I did:** Opened the alert and reviewed the key details (host, IP, file name, file path, hash, and trigger reason).  
**Why it matters:** This gives me the “starting facts” so I’m not guessing later.

![Step 1 - Check Alert Tickets](step%201%20Check%20Alert%20Tickets.png)

---

### Step 2 — Take ownership
**What I did:** Took ownership of the event.  
**Why it matters:** In a real SOC, this prevents duplicate work and shows I’m responsible for the investigation.

![Step 2 - Take Ownership](step%202%20Take%20Ownership.png)

---

### Step 3 — Create a case
**What I did:** Created a case for EventID 231.  
**Why it matters:** A case is where you collect evidence, screenshots, notes, and your final conclusion.

![Step 3 - Create Case](step%203%20Create%20Case.png)

---

### Step 4 — Review incident details
**What I did:** Opened the incident details page and confirmed the important fields (rule name, host, IP, file, hash).  
**Why it matters:** This is the main page I use to guide the rest of the steps and keep everything organized.

![Step 4 - Incident Details](step%204%20Incident%20details.png)

---

### Step 5 — Write down the important info
**What I did:** Copied the key details into a notes file (time, host, IP, file path, hash, and what triggered the alert).  
**Why it matters:** Notes help me build a clear story and make it easy to write a final summary.

![Step 5 - Info in notepad](step%205%20Info%20in%20notepad.png)

---

### Step 6 — Start the playbook
**What I did:** Started the LetsDefend playbook for the case.  
**Why it matters:** Playbooks help you follow a consistent process so you don’t skip important checks.

![Step 6 - Start Playbook](step%206%20Start%20Playbook.png)

---

### Step 7 — Check if the malware is quarantined/cleaned
**What I did:** Reached the playbook step asking whether the malware was quarantined/cleaned.  
**Why it matters:** If it’s *not* quarantined, the machine could still be actively infected.

![Step 7 - Quarantine check](Step%207%20check%20if%20malware%20quaratined.png)

---

### Step 7.1 — Review logs (Log Management)
**What I did:** Went to Log Management and looked at activity tied to the host IP (172.16.17.198).  
**Why it matters:** Logs help confirm what the host actually did (downloads, connections, suspicious behavior).

![Step 7.1 - Log Management](step%207.1%20log%20management.png)

---

### Step 7.2 — Confirm download evidence in raw logs
**What I did:** Opened raw logs to confirm the suspicious file activity in the Downloads folder.  
**Why it matters:** This supports that the suspicious document was present on the system and likely opened/run.

![Step 7.2 - Check log data for downloads](Step%207.2%20check%20log%20data%20for%20downloads.png)

---

### Step 7.3 — Check for suspicious email (possible delivery method)
**What I did:** Checked Email Security to find a suspicious email related to the incident.  
**Why it matters:** Many malicious documents arrive through phishing emails, so identifying the sender and message helps confirm how it started.

![Step 7.3 - Check for suspicious email](Step%207.3%20check%20for%20suspicious%20email.png)

---

### Step 8 — Analyze the malware using 3rd-party tools
**What I did:** Used external services (like VirusTotal and Hybrid Analysis) to confirm whether the file hash is known malicious and to get more context (macros, behavior, indicators).  
**Why it matters:** This helps validate the alert and gives extra evidence to support the final conclusion.

![Step 8 - Analyze Malware prompt](Step%208%20analyze%20malware.png)

---

### Step 8.1 — VirusTotal: search the file hash
**What I did:** Looked up the file hash in VirusTotal.  
**Why it matters:** VirusTotal shows whether multiple security vendors have flagged the file.

![Step 8.1 - VirusTotal analyze hash](step%208.1%20Virus%20total%20analyze%20hash%20of%20file.png)

---

### Step 8.2 — VirusTotal results
**What I did:** Reviewed the detection results and indicators (this file was flagged by many vendors and showed macro-related behavior).  
**Why it matters:** More detections = higher confidence the file is actually malicious.

![Step 8.2 - VirusTotal results](step%208.2%20VT%20results.png)

---

### Step 8.3 — Hybrid Analysis: search the hash
**What I did:** Searched the same hash in Hybrid Analysis to see sandbox results and reports.  
**Why it matters:** Sandboxes can show behavior/indicators beyond just “detected / not detected.”

![Step 8.3 - Hybrid Analysis hash search](step%208.3%20Hybrid%20analysis%20of%20hash.png)

---

### Step 8.4 — Hybrid Analysis report summary
**What I did:** Reviewed the sandbox reports which labeled the document as malicious.  
**Why it matters:** This adds another strong source confirming the file is harmful.

![Step 8.4 - Hybrid Analysis reports](step%208.4%20hybrid%20analysis.png)

---

### Step 8.5 — Confirm malicious + delete the email
**What I did:** After confirming the file was malicious, I deleted the suspicious email from the mail system.  
**Why it matters:** This helps prevent the same email from hitting other users.

![Step 8.5 - Delete email](step%208.5%20file%20is%20malicious%20delete%20email.png)

---

### Step 8.6 — URL analysis (VirusTotal)
**What I did:** Checked a related URL using VirusTotal URL analysis.  
**Why it matters:** Malicious documents often connect to or download from suspicious links.

![Step 8.6 - URL VT analysis](step%208.6%20URL%20VT%20analysis.png)

---

### Step 8.7 — IP reputation check (AbuseIPDB)
**What I did:** Checked the reputation of the suspicious IP address seen in logs (example: `92.204.221.16`).  
**Why it matters:** If an IP has a bad reputation, it supports the idea that the host may have reached out to malicious infrastructure.

![Step 8.7 - IP Abuse check](Step%208.7%20IP%20Abuse%20check%20IP%20rep.png)

---

### Step 9 — Check if C2 was contacted
**What I did:** Followed the playbook step to check whether the suspected C2 address was accessed by the host.  
**Why it matters:** If the host contacted C2, the case becomes more serious (possible command/control activity or payload downloads).

![Step 9 - Was C2 contacted](Step%209%20was%20C2%20contacted.png)

---

### Step 10 — Containment step (isolate the host)
**What I did:** Moved to the containment step in the playbook.  
**Why it matters:** Containment helps stop additional spread or communication while further cleanup happens.

![Step 10 - Containment playbook](Step%2010%20containment.png)

---

### Step 10.1 — Contain the host in Endpoint Security
**What I did:** Used Endpoint Security to change the containment status for host “Jayne.”  
**Why it matters:** This is a direct action to reduce risk immediately.

![Step 10.1 - Contain host](step%2010.1%20contain%20host.png)

---

### Step 10.2 — Confirm host is contained
**What I did:** Verified the host showed as “Host Contained.”  
**Why it matters:** Confirms containment is active and the machine is restricted.

![Step 10.2 - Host contained](step%2010.2%20host%20contained.png)

---

### Step 11 — Add artifacts (IOCs) to the case
**What I did:** Added key indicators to the case (example: suspicious IP, phishing sender email, suspicious URL, file hash).  
**Why it matters:** Artifacts help with tracking, blocking, and searching for related activity later.

![Step 11 - Add artifacts](Step%2011%20add%20artifacts.png)

---

### Step 12 — Write the analyst note (final summary)
**What I did:** Wrote a short analyst note explaining what happened and what actions were taken.  
**Why it matters:** This is the final “story” of the incident that someone else can read quickly.

![Step 12 - Analyst note](step%2012%20analyst%20note.png)

---

### Step 13 — Finish playbook and close the case
**What I did:** Confirmed and finished the playbook to close out the case.  
**Why it matters:** This wraps up the workflow and saves the investigation results.

![Step 13 - Finish playbook](step%2013%20finish%20playbook.png)

---

## Findings (simple summary)
- The alert involved a **macro-enabled Word document** (`edit1-invoice.docm`) tied to host **Jayne**.
- Logs supported suspicious activity tied to the host around the alert time.
- **VirusTotal** and **Hybrid Analysis** both supported that the file/hash is **malicious** (high confidence).
- I identified likely phishing delivery through **Email Security**, then removed the email to reduce risk to others.
- I checked the reputation of a suspicious IP seen in related activity, and treated it as suspicious based on reputation sources.
- I **contained the host** to help prevent further spread/communication.
- I added key **artifacts/IOCs** to the case and documented everything in an analyst note.

---

## What I would do next (real SOC workflow)
If this were a real environment, next steps would usually include:
- Run full endpoint remediation and confirm the malicious file is removed everywhere
- Reset credentials if there’s any chance the user was compromised
- Hunt across other endpoints for the same hash/sender/URL/IP
- Create blocks/detections (after confirming indicators are truly malicious)
- Collect more evidence for a full timeline (process execution, persistence, additional downloads)

---

## Notes
This project is meant to show I can follow a SOC workflow and clearly document an investigation with evidence.
